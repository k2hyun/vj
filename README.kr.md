# jvim

[Textual](https://github.com/Textualize/textual) 기반의 vim 스타일 JSON 편집기입니다.

## 주요 기능

- **Vim 스타일 모달 편집** - Normal, Insert, Command, Search 모드 지원
- **구문 강조** - JSON 문법에 맞는 색상 표시
- **JSON 검증** - 실시간 유효성 검사 및 오류 표시
- **JSONPath 검색** - JSONPath 표현식으로 검색 (`$.foo.bar`)
- **JSONL 지원** - JSON Lines 파일을 스마트하게 포맷팅하여 편집
- **내장 JSON 편집** - JSON 내 문자열로 저장된 JSON을 중첩 레벨까지 편집
- **괄호 매칭** - `%`로 짝이 맞는 괄호로 이동
- **Undo/Redo** - 전체 실행 취소 기록 지원

## 설치

```bash
pip install jvim
```

## 사용법

```bash
# 파일 열기
jvim data.json

# 읽기 전용 모드로 열기
jvim -R data.json

# 새 파일 생성
jvim newfile.json
```

`jvi`, `jv` 단축 명령도 사용 가능합니다.

## JSONL 지원

jvim은 JSON Lines (`.jsonl`) 파일을 특별하게 처리합니다:

- **포맷팅된 편집**: 각 JSONL 레코드를 자동으로 들여쓰기하여 읽고 편집하기 쉽게 표시
- **압축 저장**: 저장 시 각 레코드를 한 줄로 압축하여 JSONL 형식 유지
- **레코드 번호**: 두 번째 열에 레코드 번호(1, 2, 3...)를 표시하여 쉽게 탐색
- **플로팅 헤더**: 여러 줄에 걸친 레코드를 스크롤할 때 물리적 라인 번호가 상단에 표시

예시: 두 개의 레코드가 있는 JSONL 파일:
```
{"name": "Alice", "age": 30}
{"name": "Bob", "age": 25}
```

jvim에서 열면:
```
{
    "name": "Alice",
    "age": 30
}
{
    "name": "Bob",
    "age": 25
}
```

저장하면 원래의 압축된 형식으로 복원됩니다.

## JSONPath 검색

jvim은 값 필터링이 가능한 강력한 JSONPath 검색을 지원합니다.

### 기본 JSONPath

`$.` 또는 `$[`로 시작하는 검색 패턴은 자동으로 JSONPath로 인식됩니다:

```
/$.name              # "name" 필드 찾기
/$..email            # 모든 "email" 필드 찾기 (재귀)
/$.users[0]          # 첫 번째 사용자
/$.users[*].name     # 모든 사용자 이름
```

### 값 필터링

비교 연산자를 사용하여 값으로 검색 결과를 필터링할 수 있습니다:

| 연산자 | 설명 | 예시 |
|--------|------|------|
| `=` | 같음 | `$.status="active"` |
| `!=` | 다름 | `$.status!=null` |
| `>` | 초과 | `$.age>18` |
| `<` | 미만 | `$.price<100` |
| `>=` | 이상 | `$.count>=5` |
| `<=` | 이하 | `$.count<=10` |
| `~` | 정규식 매칭 | `$.email~@gmail\.com$` |

### 예시

```
/$.users[*].age>30           # 30세 초과 사용자
/$.items[*].status="active"  # 활성 상태인 아이템
/$..name~^J                  # J로 시작하는 모든 이름
/$.price<=1000               # 1000 이하 가격
/$.config.enabled=true       # 활성화된 설정
```

### 검색 수정자

| 접미사 | 설명 |
|--------|------|
| `\j` | 모호한 패턴을 JSONPath 모드로 강제 |
| `\c` | 대소문자 무시 (정규식 텍스트 검색용) |
| `\C` | 대소문자 구분 (정규식 텍스트 검색용) |

## 내장 JSON 편집 (ej 모드)

JSON 파일에는 종종 이스케이프된 JSON 문자열이 값으로 포함됩니다. jvim은 이러한 중첩된 JSON 구조를 자연스럽게 편집할 수 있게 해줍니다.

### 사용 방법

1. JSON 문자열 값이 있는 라인에 커서를 위치
2. Normal 모드에서 `ej` 입력
3. 새 편집기 패널이 열리며 파싱되고 포맷팅된 JSON 표시
4. 구문 강조와 유효성 검사가 적용된 상태로 내장 JSON 편집
5. `:w`로 저장하여 부모 문서에 반영(압축됨) 또는 `:q`로 취소

### 중첩 레벨

내장 JSON 안의 내장 JSON도 편집할 수 있습니다:
- 패널 제목에 현재 중첩 레벨 표시: `Edit Embedded JSON (level 1)`
- 저장하지 않은 변경 사항이 있으면 `[+]` 표시
- `:w`로 저장하고 이전 레벨로 복귀
- `:q!`로 변경 사항을 버리고 이전 레벨로 복귀

### 예시

다음과 같은 JSON이 있을 때:
```json
{
    "config": "{\"host\": \"localhost\", \"port\": 8080}"
}
```

config 라인에서 `ej`를 사용하면:
```json
{
    "host": "localhost",
    "port": 8080
}
```

편집 후 저장하면, 부모 문서에 압축된 결과가 반영됩니다.

## 키 바인딩

### 이동
| 키 | 동작 |
|-----|--------|
| `h j k l` | 왼쪽/아래/위/오른쪽 |
| `w b` | 단어 앞으로/뒤로 |
| `0 $ ^` | 줄 시작/끝/첫 문자 |
| `gg G` | 파일 시작/끝 |
| `%` | 짝 괄호로 이동 |
| `PgUp PgDn` | 페이지 위/아래 |
| `Ctrl+d/u` | 반 페이지 아래/위 |

### 검색
| 키 | 동작 |
|-----|--------|
| `/` | 앞으로 검색 |
| `?` | 뒤로 검색 |
| `n N` | 다음/이전 매치 |
| `$.path` | JSONPath 검색 (자동 감지) |
| `$.path=val` | 값 필터링 JSONPath |
| `$.path~regex` | 정규식 필터링 JSONPath |
| `\j` | 패턴에 JSONPath 접미사 추가 |
| `\c \C` | 대소문자 무시/구분 |

### 삽입 모드
| 키 | 동작 |
|-----|--------|
| `i I` | 커서 위치/줄 시작에 삽입 |
| `a A` | 커서 뒤/줄 끝에 추가 |
| `o O` | 아래/위에 새 줄 추가 |

### 편집
| 키 | 동작 |
|-----|--------|
| `x` | 문자 삭제 |
| `dd` | 줄 삭제 |
| `dw d$` | 단어/줄 끝까지 삭제 |
| `cw cc` | 단어/줄 변경 |
| `r{c}` | 문자 교체 |
| `J` | 줄 합치기 |
| `yy p P` | 복사/뒤에 붙여넣기/앞에 붙여넣기 |
| `u` | 실행 취소 |
| `Ctrl+r` | 다시 실행 |
| `.` | 마지막 편집 반복 |
| `ej` | 내장 JSON 문자열 편집 |

### 명령어
| 명령어 | 동작 |
|---------|--------|
| `:w` | 저장 |
| `:w {file}` | 다른 이름으로 저장 |
| `:e {file}` | 파일 열기 |
| `:fmt` | JSON 포맷팅 |
| `:q` | 종료 |
| `:q!` | 변경 사항 버리고 종료 |
| `:wq` | 저장하고 종료 |
| `:help` | 도움말 패널 토글 |

## 라이선스

MIT
